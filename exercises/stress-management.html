<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stress Management Exercise - MindMatters</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-[#0D1117] text-[#C9D1D9]">
    <!-- Navigation -->
    <nav class="bg-[#161B22] p-4">
        <div class="container mx-auto flex justify-between items-center">
            <a href="../index.html" class="text-[#58A6FF] text-xl font-bold">MindMatters</a>
            <div class="hidden md:flex space-x-6">
                <a href="../index.html" class="text-[#C9D1D9] hover:text-[#58A6FF]">Home</a>
                <a href="../index.html#about" class="text-[#C9D1D9] hover:text-[#58A6FF]">About</a>
                <a href="../index.html#resources" class="text-[#C9D1D9] hover:text-[#58A6FF]">Resources</a>
                <a href="../index.html#contact" class="text-[#C9D1D9] hover:text-[#58A6FF]">Contact</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
        <div id="quiz-container" class="max-w-3xl mx-auto">
            <h1 class="text-4xl font-bold text-center mb-8 text-[#58A6FF]">Stress Management Assessment</h1>
            <p class="text-center mb-12 text-lg">Answer the following questions to assess your stress management skills.</p>

            <form id="stress-management-quiz" class="space-y-8">
                <!-- Questions will be dynamically inserted here -->
                <div class="text-center mt-8 space-x-4">
                    <button type="submit" class="bg-[#58A6FF] text-[#0D1117] px-8 py-3 rounded-lg hover:bg-[#238636] hover:text-[#C9D1D9] transition-colors text-lg">
                        Submit Answers
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Section (Hidden initially) -->
        <div id="results-container" class="max-w-4xl mx-auto hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#58A6FF]">Your Results</h2>
            
            <!-- Groq Analysis Section -->
            <div class="bg-[#161B22] p-6 rounded-lg mb-12">
                <h3 class="text-2xl font-bold mb-4 text-[#C9D1D9]">Professional Analysis</h3>
                <div id="groq-analysis" class="space-y-4">
                    <div class="animate-pulse">
                        <div class="h-4 bg-[#58A6FF]/20 rounded w-3/4 mb-4"></div>
                        <div class="h-4 bg-[#58A6FF]/20 rounded w-1/2"></div>
                    </div>
                </div>
            </div>

            <div class="text-center space-x-4">
                <a href="../exercises.html" class="inline-block bg-[#58A6FF] text-[#0D1117] px-8 py-3 rounded-lg hover:bg-[#238636] hover:text-[#C9D1D9] transition-colors text-lg">
                    Back to Exercises
                </a>
                <button id="downloadPdf" class="inline-block bg-[#238636] text-[#C9D1D9] px-8 py-3 rounded-lg hover:bg-[#58A6FF] hover:text-[#0D1117] transition-colors text-lg">
                    <i class="fas fa-download mr-2"></i>Download PDF
                </button>
            </div>
        </div>
    </main>

    <footer class="relative bg-[#161B22] text-[#C9D1D9] overflow-hidden">
        <div class="absolute inset-0 bg-[#0D1117] opacity-10"></div>
        <div class="max-w-7xl mx-auto px-4 py-16 relative">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div class="col-span-1 md:col-span-2">
                    <h2 class="text-3xl font-bold mb-6 text-[#58A6FF]">MindMatters</h2>
                    <p class="text-lg mb-6">Empowering young adults with emotional intelligence and goal achievement tools for a better tomorrow.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-6 text-[#58A6FF]">Quick Links</h3>
                    <ul class="space-y-4">
                        <li><a href="../index.html#home" class="hover:text-[#58A6FF] transition-colors">Home</a></li>
                        <li><a href="../index.html#about" class="hover:text-[#58A6FF] transition-colors">About</a></li>
                        <li><a href="../index.html#resources" class="hover:text-[#58A6FF] transition-colors">Resources</a></li>
                        <li><a href="../index.html#case-studies" class="hover:text-[#58A6FF] transition-colors">Case Studies</a></li>
                        <li><a href="../index.html#blog" class="hover:text-[#58A6FF] transition-colors">Blog</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-6 text-[#58A6FF]">Team Members</h3>
                    <ul class="space-y-4">
                        <li><p class="hover:text-[#58A6FF] transition-colors">M. Saad Salman Khan</p></li>
                        <li><p class="hover:text-[#58A6FF] transition-colors">Zakaria Shahid</p></li>
                        <li><p class="hover:text-[#58A6FF] transition-colors">Umair Iftikhar</p></li>
                        <li><p class="hover:text-[#58A6FF] transition-colors">M. Anas Sheryar</p></li>
                        <li><p class="hover:text-[#58A6FF] transition-colors">Shahmeer</p></li>
                    </ul>
                </div>
            </div>
            <div class="mt-16 pt-8 border-t border-[#C9D1D9]/20">
                <div class="flex flex-col md:flex-row justify-center items-center">
                    <p class="text-center md:text-left mb-4 md:mb-0">&copy; 2025 MindMatters. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Quiz Questions
        const questions = [
            {
                question: "How often do you experience physical symptoms of stress?",
                options: ["Very Frequently", "Often", "Sometimes", "Rarely"],
                category: "Physical Symptoms"
            },
            {
                question: "How well do you manage your time to reduce stress?",
                options: ["Poorly", "Somewhat", "Well", "Very well"],
                category: "Time Management"
            },
            {
                question: "How often do you practice stress-reduction techniques?",
                options: ["Never", "Rarely", "Sometimes", "Regularly"],
                category: "Stress Management"
            },
            {
                question: "How well do you maintain work-life balance?",
                options: ["Poorly", "Somewhat", "Well", "Very well"],
                category: "Work-Life Balance"
            },
            {
                question: "How often do you feel overwhelmed by responsibilities?",
                options: ["Very Frequently", "Often", "Sometimes", "Rarely"],
                category: "Responsibility Management"
            },
            {
                question: "How well do you handle unexpected changes?",
                options: ["Poorly", "Somewhat", "Well", "Very well"],
                category: "Adaptability"
            },
            {
                question: "How often do you get adequate sleep?",
                options: ["Rarely", "Sometimes", "Often", "Very Frequently"],
                category: "Sleep Habits"
            },
            {
                question: "How well do you maintain healthy eating habits during stress?",
                options: ["Poorly", "Somewhat", "Well", "Very well"],
                category: "Nutrition"
            },
            {
                question: "How often do you exercise or engage in physical activity?",
                options: ["Rarely", "Sometimes", "Often", "Very Frequently"],
                category: "Physical Activity"
            },
            {
                question: "How well do you communicate your stress to others?",
                options: ["Poorly", "Somewhat", "Well", "Very well"],
                category: "Communication"
            }
        ];

        // Initialize Quiz
        function initializeQuiz() {
            const form = document.getElementById('stress-management-quiz');
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'bg-[#161B22] p-6 rounded-lg';
                questionDiv.innerHTML = `
                    <h3 class="text-xl font-bold mb-4 text-[#C9D1D9]">${index + 1}. ${q.question}</h3>
                    <div class="space-y-3">
                        ${q.options.map((option, i) => `
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="radio" name="q${index}" value="${i}" required
                                    class="form-radio text-[#58A6FF] focus:ring-[#58A6FF]">
                                <span class="text-[#C9D1D9]">${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                form.appendChild(questionDiv);
            });
        }

        // Calculate Results
        function calculateResults(formData) {
            const results = {
                categories: {},
                totalScore: 0,
                answers: [] // Store answers for Groq API
            };

            questions.forEach((q, index) => {
                const answer = parseInt(formData.get(`q${index}`));
                const score = answer + 1; // Convert 0-3 to 1-4

                // Store answer for Groq API
                results.answers.push({
                    question: q.question,
                    options: q.options,
                    category: q.category,
                    answer: q.options[answer]
                });

                if (!results.categories[q.category]) {
                    results.categories[q.category] = {
                        total: 0,
                        count: 0
                    };
                }

                results.categories[q.category].total += score;
                results.categories[q.category].count += 1;
                results.totalScore += score;
            });

            // Calculate averages
            Object.keys(results.categories).forEach(category => {
                results.categories[category].average =
                    results.categories[category].total / results.categories[category].count;
            });

            results.averageScore = results.totalScore / questions.length;
            return results;
        }

        // Call Groq API
        async function callGroqAPI(answers) {
            // Get API key for testing - replace with your actual key
            const apiKey = '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';
            
            console.log('API Key (first 10 chars):', apiKey.substring(0, 10) + '...');
            const prompt = `
                You are a professional psychologist specializing in Stress Management, with a particular focus on helping individuals develop effective coping strategies and maintain work-life balance.

                You have received answers to a 10-question multiple-choice quiz specifically designed to assess a person's Stress Management abilities.

                Here are the questions and the user's answers:

                ${answers.map((q, index) => `
                    Question ${index + 1}: ${q.question}
                    User's Answer: ${q.answer}
                    Category: ${q.category}
                `).join('\n')}

                Based on these answers, provide a concise, insightful, and professional psychological analysis focusing only on the respondent's stress management abilities.

                Structure your response using EXACTLY this format with these exact headings:

                1. Introduction
                   - Brief explanation of what Stress Management is.
                   - Mention that this analysis is based on a 10-question quiz response.

                2. Strengths
                   - Bullet points summarizing areas where the respondent demonstrates strong stress management.
                   - Include examples like: healthy coping strategies, work-life balance, relaxation techniques, etc.

                3. Areas for Improvement
                   - Bullet points where the respondent may struggle (e.g., difficulty managing time, challenges in relaxation, etc.).
                   - Keep feedback constructive and respectful.

                4. Recommendations
                   - Short list of practical strategies or exercises to improve stress management.
                   - Example: mindfulness exercises, time management techniques, relaxation methods, etc.

                5. Conclusion
                   - Encouraging closing statement reinforcing the importance of stress management.
                   - Optional motivational sentence about how managing stress improves overall well-being.

                IMPORTANT: Use exactly these 5 headings: "1. Introduction", "2. Strengths", "3. Areas for Improvement", "4. Recommendations", "5. Conclusion". Do not use any other headings or numbering.

                Use simple, professional, and empathetic language. Avoid psychological jargon. Make the analysis feel personalized, warm, and helpful — as if written by a caring psychologist.
            `;

            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-8b-instant',
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        temperature: 0.7,
                        max_tokens: 1500
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Groq API Error:', response.status, errorData);
                    return 'Unable to generate professional analysis at this time. Please try again later.';
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return data.choices[0].message.content;
                } else {
                    console.error('Unexpected response format:', data);
                    return 'Unable to generate professional analysis at this time.';
                }
            } catch (error) {
                console.error('Error calling Groq API:', error);
                return 'Unable to generate professional analysis at this time.';
            }
        }

        // Display Results
        async function displayResults(results) {
            const quizContainer = document.getElementById('quiz-container');
            const resultsContainer = document.getElementById('results-container');
            
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');

            // Get Groq Analysis
            const groqAnalysis = document.getElementById('groq-analysis');
            const groqResponse = await callGroqAPI(results.answers);
                
            // Remove all asterisks from the response
            let formattedResponse = groqResponse.replace(/\*/g, '');
                
            // Format the 5 main headings
            const mainHeadings = [
                '1. Introduction',
                '2. Strengths',
                '3. Areas for Improvement',
                '4. Recommendations',
                '5. Conclusion'
            ];

            // First, split the response into sections
            let sections = formattedResponse.split(/(?=\d\.\s)/);
            
            // Process each section
            formattedResponse = sections.map(section => {
                // Find the heading
                const headingMatch = section.match(/^(\d\.\s.*?)(?=\n|$)/);
                if (headingMatch) {
                    const heading = headingMatch[1].trim();
                    const content = section.substring(headingMatch[0].length).trim();
                    
                    // Process the content
                    const lines = content.split('\n').filter(line => line.trim());
                    const processedLines = lines.map(line => {
                        if (line.trim().startsWith('-')) {
                            return `<li class="ml-6 mb-3 text-[#C9D1D9] text-base">${line.trim().substring(1).trim()}</li>`;
                        } else {
                            return `<p class="mb-4 text-[#C9D1D9] text-base leading-relaxed">${line.trim()}</p>`;
                        }
                    });

                    return `
                        <div class="mb-10 bg-[#161B22] p-6 rounded-lg border-l-4 border-[#58A6FF]">
                            <h4 class="text-3xl font-bold mb-6 text-[#58A6FF] leading-tight">${heading}</h4>
                            <div class="space-y-3">
                                ${processedLines.join('\n')}
                            </div>
                        </div>
                    `;
                }
                return section;
            }).join('');

            groqAnalysis.innerHTML = `<div class="prose prose-invert max-w-none">${formattedResponse}</div>`;

            // Store results for PDF generation
            window.quizResults = {
                results: results,
                groqAnalysis: formattedResponse
            };
        }

        // Generate and Download PDF
        document.getElementById('downloadPdf').addEventListener('click', async () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set initial position
            let yPosition = 20;
            const margin = 20;
            const lineHeight = 7;
            const headingHeight = 12;
            
            // Add title
            doc.setFontSize(24);
            doc.setTextColor(0, 51, 102);
            doc.text('Stress Management Assessment Results', margin, yPosition);
            
            // Add date
            yPosition += 15;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, margin, yPosition);
            
            // Process the Groq analysis content
            const content = window.quizResults.groqAnalysis;
            const parser = new DOMParser();
            const doc2 = parser.parseFromString(content, 'text/html');
            
            // Get all elements
            const elements = doc2.body.children;
            
            // Process each element
            for (let element of elements) {
                yPosition += 10; // Add spacing between elements
                
                if (yPosition > 270) { // Check if we need a new page
                    doc.addPage();
                    yPosition = 20;
                }
                
                if (element.tagName === 'DIV') {
                    // Handle section div
                    const heading = element.querySelector('h4');
                    const contentDiv = element.querySelector('div');
                    
                    if (heading) {
                        // Format main headings
                        doc.setFontSize(18);
                        doc.setTextColor(0, 51, 102);
                        doc.text(heading.textContent, margin, yPosition);
                        yPosition += headingHeight;
                    }
                    
                    if (contentDiv) {
                        // Process content div elements
                        const contentElements = contentDiv.children;
                        for (let contentElement of contentElements) {
                            if (contentElement.tagName === 'LI') {
                                // Format bullet points
                                doc.setFontSize(12);
                                doc.setTextColor(0, 0, 0);
                                const bulletPoint = '• ' + contentElement.textContent;
                                const splitText = doc.splitTextToSize(bulletPoint, 170);
                                doc.text(splitText, margin + 5, yPosition);
                                yPosition += (splitText.length * lineHeight);
                            } else if (contentElement.tagName === 'P') {
                                // Format paragraphs
                                doc.setFontSize(12);
                                doc.setTextColor(0, 0, 0);
                                const splitText = doc.splitTextToSize(contentElement.textContent, 170);
                                doc.text(splitText, margin, yPosition);
                                yPosition += (splitText.length * lineHeight);
                            }
                        }
                    }
                }
            }
            
            // Save the PDF
            doc.save('stress-management-results.pdf');
        });

        // Handle Form Submission
        document.getElementById('stress-management-quiz').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const results = calculateResults(formData);
            displayResults(results);
        });

        // Initialize Quiz
        initializeQuiz();
    </script>
</body>
</html> 